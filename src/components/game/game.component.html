<div class="game-container" [class.waiting-turn]="!isYourTurn">
  <h2 class="game-title-enhanced">
    <span class="title-number">3️⃣1️⃣</span>
    <span class="room-code"> Sala: {{roomCode}}</span>
  </h2>
  
  <!-- Información del jugador -->
  <div class="player-info">
    <p *ngIf="isYourTurn && room?.status !== 'round_closing'" class="turn-indicator">🎯 Es tu turno</p>
    <p *ngIf="isYourTurn && room?.status === 'round_closing'" class="last-turn-indicator">⚡ ¡ÚLTIMA RONDA! Es tu turno final</p>
    <p *ngIf="!isYourTurn && room?.status !== 'round_closing'" class="waiting">⏳ Esperando turno...</p>
    <p *ngIf="!isYourTurn && room?.status === 'round_closing'" class="you-closed">✅ Te plantaste - El otro jugador tiene un turno más</p>
  </div>

  <!-- Mesa de juego - Mazo y Descarte en fila -->
  <div class="game-table">
    <div class="deck-discard-row">
      <!-- Mazo boca abajo -->
      <div class="deck-area mr-3">
        <h3>Mazo</h3>
        <div class="deck-stack">
          <div class="deck-card deck-card-1"></div>
          <div class="deck-card deck-card-2"></div>
          <div class="deck-card deck-card-3" 
               [class.deck-drawing]="isDrawingFromDeck"
               (click)="drawFromDeck()">
            <img src="/assets/cards/RV.png" alt="Mazo" class="card-image">
          </div>
        </div>
        <p class="deck-count">{{getDeckCount()}} cartas</p>
      </div>

      <!-- Pila de descarte -->
      <div class="discard-area">
        <h3>Descarte</h3>
        <div class="discard-stack" *ngIf="room.discardPile && room.discardPile.length > 0">
          <div *ngFor="let card of room.discardPile.slice(-1)" 
               class="card discard-card"
               [class.discard-glow]="canDrawFromDiscard()"
               (click)="drawFromDiscard()">
            <img [src]="getCardImagePath(card)" 
                 [alt]="getCardDisplayName(card)"
                 class="card-image"
                 (error)="onImageError($event, card)">
          </div>
        </div>
        <div class="empty-discard" *ngIf="!room.discardPile || room.discardPile.length === 0">
          <div class="empty-pile">Vacío</div>
        </div>
      </div>
    </div>

    <!-- Carta robada debajo del mazo y descarte -->
    <div *ngIf="drawnCard" class="drawn-card-area">
      <h4>Robada:</h4>
      <div class="drawn-card-container">
        <div class="card drawn-card" [class.card-flip-in]="showDrawnCardAnimation">
          <img [src]="getCardImagePath(drawnCard)" 
               [alt]="getCardDisplayName(drawnCard)"
               class="card-image"
               (error)="onImageError($event, drawnCard)">
          <div class="card-fallback" style="display: none;">
            <div class="card-value">{{getCardValue(drawnCard)}}</div>
            <div class="card-suit" [ngClass]="'suit-' + getCardSuit(drawnCard)">
              {{getSuitSymbol(getCardSuit(drawnCard))}}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Cartas del jugador con puntuación integrada -->
  <div class="player-hand">
    <div class="player-hand-header">
      <h4 class="player-score-header">
        <span class="player-icon">{{ getPlayerIcon() }}</span>
        <span class="score-text">Tus cartas ({{calculateHandPoints()}} puntos)</span>
      </h4>
    </div>
    <div class="cards-container">
      <div *ngFor="let card of playerCards; let i = index" 
           class="card player-card" 
           [class.selected]="selectedCardIndex === i"
           [class.card-entering]="cardAnimations[i]?.entering"
           [class.card-leaving]="cardAnimations[i]?.leaving"
           (click)="selectCard(i)"
           [style.animation-delay]="i * 0.1 + 's'">
        <img [src]="getCardImagePath(card)" 
             [alt]="getCardDisplayName(card)"
             class="card-image"
             (error)="onImageError($event, card)">
        <div class="card-fallback" style="display: none;">
          <div class="card-value">{{getCardValue(card)}}</div>
          <div class="card-suit" [ngClass]="'suit-' + getCardSuit(card)">
            {{getSuitSymbol(getCardSuit(card))}}
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Acciones del juego -->
  <div class="game-actions">
    <ng-container *ngIf="!drawnCard">
      <button class="btn btn-draw-deck action-btn" 
              [disabled]="!isYourTurn" 
              (click)="drawFromDeck()">
        <span class="btn-icon">🎴</span>
        <span class="btn-text">Robar Mazo</span>
      </button>
      <button class="btn btn-draw-discard action-btn" 
              [disabled]="!isYourTurn || !canDrawFromDiscard()" 
              (click)="drawFromDiscard()">
        <span class="btn-icon">♻️</span>
        <span class="btn-text">Robar Descarte</span>
      </button>
    </ng-container>
    
       <ng-container *ngIf="drawnCard">
      <button class="btn btn-swap action-btn" 
              [disabled]="selectedCardIndex === -1 || !isYourTurn" 
              (click)="confirmCardSwap()">
        <span class="btn-icon">🔄</span>
        <span class="btn-text">Cambiar</span>
      </button>
      <button class="btn btn-pass action-btn" 
              [disabled]="!isYourTurn"
              (click)="keepCurrentCards()">
        <span class="btn-icon">👋</span>
        <span class="btn-text">Pasar</span>
      </button>
    </ng-container>

    <!-- Solo mostrar botón cerrar si tiene 21+ puntos -->
    <button *ngIf="calculateHandPoints() >= 21 && isYourTurn && !drawnCard && room.status !== 'round_closing'" 
            class="btn btn-close action-btn" 
            (click)="closeRound()">
      <span class="btn-icon">🎯</span>
      <span class="btn-text">¡Cerrar!</span>
    </button>
  </div>
</div>

<!-- Overlay para mostrar imagen del ganador -->
<div *ngIf="showWinnerImage" class="winner-overlay">
  <div class="winner-content">
    <img [src]="winnerImageSrc" [alt]="winnerText" class="winner-image">
    <h2 class="winner-text">{{ winnerText }}</h2>
  </div>
</div>
